function get_rules_json(){var e=[];$(".custom-fields-rules .line-group-container .line-group").each(function(a,t){var l=$(this),i={};i.field_relation=l.attr("data-rel"),i.field_options=[];var s=l.find(".rules-b-group select:not(.hidden)");s.each(function(e,a){var t=$(this),l={};l.rel_name=t.attr("data-rel"),l.rel_value=t.val(),l.rel_type=t.closest(".rules-b-group").prev(".rule-type").val(),i.field_options.push(l)}),e.push(i)}),$("#custom_fields_rules").html(JSON.stringify(e)),$("#custom_fields_rules").val(JSON.stringify(e))}function reload_order_numb(e){e.each(function(e,a){var t=$(this),l=e+1;t.attr("data-position",l)})}function my_custom_json_output(e,a){var t=returned_json(e,a,!1);return t}function returned_json(e,a,t){var l=[];return e.each(function(e,i){var s=$(this),o={};o.id=s.data("id"),o.instructions=s.data("instructions"),o.name=s.data("name"),o.options=s.data("options"),o.title=s.data("title"),o.type=s.data("type");var d=s.find('> .item-details > .options > div[data-option="repeater"] > .col-xs-9 > .add-new-field > .sortable-wrapper > li');if(a===!0&&(o.repeateritems=[],d.length>0)){var n=returned_json(d,!0,o.repeateritems);0!=n&&o.repeateritems.push(n)}"object"==typeof t?t.push(o):l.push(o)}),"object"==typeof t?0:l}function init_options(){var e={defaultvalue:"",placeholdertext:"",defaultvaluetextarea:"",wyswygtoolbar:"",selectchoices:"",buttonlabel:""};$(".sortable-wrapper > li").data("options",e),$(".item-details > .options input, .item-details > .options select, .item-details > .options textarea").each(function(e,a){var t=$(this).closest(".options"),l={defaultvalue:"",placeholdertext:"",defaultvaluetextarea:"",wyswygtoolbar:"",selectchoices:"",buttonlabel:""},i=t.find(' > [data-option="defaultvalue"]');i.length>0&&(l.defaultvalue=i.find("input").val());var s=t.find(' > [data-option="placeholdertext"]');s.length>0&&(l.placeholdertext=s.find("input").val());var o=t.find(' > [data-option="defaultvaluetextarea"]');o.length>0&&(l.defaultvaluetextarea=o.find("textarea").val());var d=t.find(' > [data-option="wyswygtoolbar"]');d.length>0&&(l.wyswygtoolbar=d.find('input[type="radio"]:checked').val());var n=t.find(' > [data-option="selectchoices"]');n.length>0&&(l.selectchoices=n.find("textarea").val());var r=t.find(' > [data-option="buttonlabel"]');r.length>0&&(l.buttonlabel=r.find("input").val());var c=t.closest("li");c.data("options",l),c.attr("data-options",JSON.stringify(l))})}$(window).load(function(){function e(e,a){var t='<li class="active" data-position="0" data-repeateritems=\'\' data-options=\'\' data-id="" data-name="" data-title="New field" data-type="text" data-instructions="">';return t+='<div class="field-column">',t+='<div class="text col-xs-4 field-label">New field</div>',t+='<div class="text col-xs-4 field-name"></div>',t+='<div class="text col-xs-4 field-type">text</div>',t+='<a href="#" title="" class="show-item-details"><i class="fa fa-angle-down"></i></a>',t+='<div class="clearfix"></div>',t+="</div>",t+='<div class="item-details">',t+='<div class="line" data-option="title">',t+='<div class="col-xs-3">',t+="<h5>Field Label</h5>",t+="<p>This is the name which will appear on the EDIT page</p>",t+="</div>",t+='<div class="col-xs-9">',t+='<input type="text" class="form-control" placeholder="" value="New field">',t+="</div>",t+='<div class="clearfix"></div>',t+="</div>",t+='<div class="line" data-option="instructions">',t+='<div class="col-xs-3">',t+="<h5>Field Instructions</h5>",t+="<p>Instructions for authors. Shown when submitting data</p>",t+="</div>",t+='<div class="col-xs-9">',t+='<input type="text" class="form-control" placeholder="" value="">',t+="</div>",t+='<div class="clearfix"></div>',t+="</div>",t+='<div class="line" data-option="name">',t+='<div class="col-xs-3">',t+="<h5>Field Name</h5>",t+="<p>Single word, no spaces. Underscores and dashes allowed</p>",t+="</div>",t+='<div class="col-xs-9">',t+='<input type="text" class="form-control" placeholder="" value="">',t+="</div>",t+='<div class="clearfix"></div>',t+="</div>",t+='<div class="line" data-option="type">',t+='<div class="col-xs-3">',t+="<h5>Field Type</h5>",t+="</div>",t+='<div class="col-xs-9">',t+='<select name="" class="form-control change-field-type">',t+='<optgroup label="Basic">',t+='<option value="text" selected="selected">Text</option>',t+='<option value="textarea">Textarea</option>',t+='<option value="number">Number</option>',t+='<option value="email">Email</option>',t+='<option value="password">Password</option>',t+="</optgroup>",t+='<optgroup label="Content">',t+='<option value="wyswyg">WYSWYG editor</option>',t+='<option value="image">Image</option>',t+='<option value="file">File</option>',t+="</optgroup>",t+='<optgroup label="Choice">',t+='<option value="select">Select</option>',t+='<option value="checkbox">Checkbox</option>',t+='<option value="radio">Radio button</option>',t+="</optgroup>",1!=a&&(t+='<optgroup label="Other">',t+='<option value="repeater">Repeater</option>',t+="</optgroup>"),t+="</select>",t+="</div>",t+='<div class="clearfix"></div>',t+="</div>",t+='<div class="options">',t+='<div data-option="defaultvalue" class="line">',t+='<div class="col-xs-3">',t+="<h5>Default Value</h5>",t+="<p>Appears when creating a new post</p>",t+="</div>",t+='<div class="col-xs-9">',t+='<input type="text" value="" placeholder="" class="form-control">',t+="</div>",t+='<div class="clearfix"></div>',t+="</div>",t+='<div data-option="placeholdertext" class="line">',t+='<div class="col-xs-3">',t+="<h5>Placeholder Text</h5>",t+="<p>Appears within the input</p>",t+="</div>",t+='<div class="col-xs-9">',t+='<input type="text" value="" placeholder="" class="form-control">',t+="</div>",t+='<div class="clearfix"></div>',t+="</div>",t+="</div>",t+='<div class="text-right pad-top-10 pad-bot-10 pad-rig-10">',t+='<a class="btn red btn-remove" title="" href="#">Remove</a>',t+='<a class="btn blue btn-close-field" title="" href="#">Close fields</a>',t+="</div>",t+="</div>",t+='<div class="clearfix"></div>',t+="</li>"}var a=$("body"),t=0,l="";l+='<div class="line" data-option="repeater">',l+='<div class="col-xs-3">',l+="<h5>Repeater fields</h5>",l+="</div>",l+='<div class="col-xs-9">',l+='<div class="add-new-field">',l+='<ul class="list-group field-table-header">',l+='<li class="col-xs-4 list-group-item w-bold">Field Label</li>',l+='<li class="col-xs-4 list-group-item w-bold">Field Name</li>',l+='<li class="col-xs-4 list-group-item w-bold">Field Type</li>',l+='<li class="clearfix"></li>',l+="</ul>",l+='<div class="clearfix"></div>',l+='<ul class="sortable-wrapper ui-sortable">',l+="</ul>",l+='<div class="text-right pad-top-10">',l+='<a class="btn red btn-add-field" title="" href="repeater">Add field</a>',l+="</div>",l+="</div>",l+="</div>",l+='<div class="clearfix"></div>',l+="</div>",a.on("click","a.show-item-details",function(e){e.preventDefault();var a=$(this).closest("li");$(this).toggleClass("active"),a.toggleClass("active")});var i={defaultvalue:'<div class="line" data-option="defaultvalue"><div class="col-xs-3"><h5>Default Value</h5><p>Appears when creating a new post</p></div><div class="col-xs-9"><input type="text" class="form-control" placeholder="" value=""></div><div class="clearfix"></div></div>',placeholdertext:'<div class="line" data-option="placeholdertext"><div class="col-xs-3"><h5>Placeholder Text</h5><p>Appears within the input</p></div><div class="col-xs-9"><input type="text" class="form-control" placeholder="" value=""></div><div class="clearfix"></div></div>',defaultvaluetextarea:'<div class="line" data-option="defaultvaluetextarea"><div class="col-xs-3"><h5>Default Value</h5><p>Appears when creating a new post</p></div><div class="col-xs-9"><textarea class="form-control" rows="3"></textarea></div><div class="clearfix"></div></div>',minimumvalue:'<div class="line" data-option="minimumvalue"><div class="col-xs-3"><h5>Minimum value</h5></div><div class="col-xs-9"><input type="number" class="form-control" placeholder="" value=""></div><div class="clearfix"></div></div>',maximumvalue:'<div class="line" data-option="maximumvalue"><div class="col-xs-3"><h5>Maximum value</h5></div><div class="col-xs-9"><input type="number" class="form-control" placeholder="" value=""></div><div class="clearfix"></div></div>',stepsize:'<div class="line" data-option="stepsize"><div class="col-xs-3"><h5>Step size</h5></div><div class="col-xs-9"><input type="number" class="form-control" placeholder="" value=""></div><div class="clearfix"></div></div>',wyswygtoolbar:'<div class="line" data-option="wyswygtoolbar"><div class="col-xs-3"><h5>Toolbar</h5></div><div class="col-xs-9"><label><input type="radio" placeholder="" name="radio_wyswygtoolbar_'+t+'" value="full" class="radio-wyswygtoolbar form-control">Full</label><label><input type="radio" placeholder="" name="radio_wyswygtoolbar_'+t+'" value="basic" checked="checked" class="radio-wyswygtoolbar form-control">Basic</label></div><div class="clearfix"></div></div>',selectchoices:'<div class="line" data-option="selectchoices"><div class="col-xs-3"><h5>Choices</h5><p>Enter each choice on a new line.<br> For more control, you may specify both a value and label like this:<br>red: Red<br>blue: Blue</p></div><div class="col-xs-9"><textarea class="form-control" rows="3"></textarea></div><div class="clearfix"></div></div>',minimumrows:'<div class="line" data-option="minimumrows"><div class="col-xs-3"><h5>Minimum row</h5></div><div class="col-xs-9"><input type="number" class="form-control" placeholder="" value=""></div><div class="clearfix"></div></div>',maximumrows:'<div class="line" data-option="maximumrows"><div class="col-xs-3"><h5>Maximum row</h5></div><div class="col-xs-9"><input type="number" class="form-control" placeholder="" value=""></div><div class="clearfix"></div></div>',buttonlabel:'<div class="line" data-option="buttonlabel"><div class="col-xs-3"><h5>Button label</h5></div><div class="col-xs-9"><input type="text" class="form-control" placeholder="" value=""></div><div class="clearfix"></div></div>',repeater:l},s=function(e){var a="";switch(e){case"text":a+=i.defaultvalue+i.placeholdertext;break;case"textarea":a+=i.defaultvaluetextarea+i.placeholdertext;break;case"number":a+=i.defaultvaluetextarea+i.placeholdertext;break;case"email":return s("text");case"password":return s("text");case"wyswyg":a+=i.defaultvaluetextarea+i.placeholdertext+i.wyswygtoolbar;break;case"image":return"";case"file":return"";case"select":a+=i.selectchoices+i.defaultvalue;break;case"checkbox":a+=i.selectchoices+i.defaultvalue;break;case"radio":a+=i.selectchoices+i.defaultvalue;break;case"repeater":a+=i.repeater+i.buttonlabel}return a};a.on("change",".change-field-type",function(e){e.preventDefault();var a=$(this),t=a.parent().parent(),l=t.find("~ .options");l.html(s(a.val())),App.initUniform()}),a.on("click",".btn-add-field",function(a){a.preventDefault();var l=$(this);t++;var i=l.closest(".add-new-field").find("> .sortable-wrapper");if("repeater"==l.attr("href"))var s=e(t,!0);else var s=e(t,!1);i.append(s),reload_order_numb(i.find("> li")),App.initUniform()});var o=[];$("#deleted_items").val(""),a.on("click",".btn-remove",function(e){e.preventDefault();var a=$(this).closest("li"),t=a.parent();o.push(a.attr("data-id")),a.animate({top:-60,left:60,opacity:.3},300,function(){a.remove(),reload_order_numb(t.find("> li")),$("#deleted_items").val(window.JSON.stringify(o))})}),a.on("click",".btn-close-field",function(e){e.preventDefault();var a=$(this).closest("li");a.removeClass("active"),a.find("a.show-item-details").removeClass("active")}),a.on("change",".item-details > .line input, .item-details > .line select, .item-details > .line textarea",function(e){e.preventDefault();var a=$(this).closest(".line"),t=a.closest("li");t.data(a.attr("data-option"),$(this).val()),t.attr("data-"+a.attr("data-option"),$(this).val()),t.find("> .field-column .field-label").html(t.find('> .item-details > [data-option="title"] input').val()),t.find("> .field-column .field-name").html(t.find('> .item-details > [data-option="name"] input').val()),t.find("> .field-column .field-type").html(t.find('> .item-details > [data-option="type"] select').val())}),a.on("change",".rule-line select.rule-a",function(e){e.preventDefault();var a=$(this),t=a.closest(".rule-line");t.find(".rules-b-group select").addClass("hidden"),t.find('.rules-b-group select[data-rel="'+a.val()+'"]').removeClass("hidden")}),$(".rule-line select.rule-a").trigger("change"),a.on("click",".location-add-rule",function(e){e.preventDefault();var a="",t=$(this),l=t.closest(".rule-line");t.hasClass("location-add-rule-and")?(a+='<div class="line rule-line rule-and">',a+=l.html(),a+="</div>",l.parent().append(a)):(l=t.parent().parent(),a+='<div class="line-group or-group" data-text="Or" data-rel="or"><div class="line rule-line rule-and">',a+=l.find("> .line-group-container > .line-group > .rule-line:first-child").html(),a+="</div></div>",$(".line-group-container").append(a)),$(".rule-line select.rule-a").trigger("change")}),a.on("click",".remove-rule-line",function(e){e.preventDefault();var a=$(this).closest(".rule-line");if(1!=a.parent().hasClass("and-group")){var t=!1;1==a.parent().find("> .rule-line").length&&(t=!0),a.animate({opacity:.3},300,function(){t?a.parent().remove():a.remove()})}else 1!=a.is(":first-child")&&a.animate({opacity:.3},300,function(){a.remove()})});var d=d=jQuery.parseJSON($("#custom_fields_rules").val());a.on("click",'button, .page-content-wrapper .page-content form [type="submit"]',function(e){e.preventDefault();var a=$(this);Utility.showLoading(),init_options(),$("#nestable-output").val(JSON.stringify(my_custom_json_output($(".nestable-group > .add-new-field > .sortable-wrapper > li"),!0))),get_rules_json(),a.closest("form").submit()})});