var MenuNestable=function(){function t(t){t.each(function(t,a){var e=$(this);e.data("id",e.attr("data-id")),e.data("title",e.attr("data-title")),e.data("relatedid",e.attr("data-relatedid")),e.data("type",e.attr("data-type")),e.data("customurl",e.attr("data-customurl")),e.data("class",e.attr("data-class"))})}function a(t){return t.nestable("serialize")}function e(t){var a=t;return $.each(a,function(t,a){a.position=t,"undefined"==typeof a.children&&(a.children=[]),e(a.children)}),a}return $body=$("body"),{init:function(){var t=parseInt($("#nestable").attr("data-depth"));1>t&&(t=5),$(".nestable-menu").nestable({group:1,maxDepth:t,expandBtnHTML:"",collapseBtnHTML:""})},handleNestableMenu:function(){$body.on("click",".dd-item .dd3-content a.show-item-details",function(t){t.preventDefault();var a=$(this).parent().parent();$(this).toggleClass("active"),a.toggleClass("active")}),$body.on("change blur keyup",'.nestable-menu .item-details input[type="text"]',function(a){a.preventDefault();var e=$(this),l=e.closest("li.dd-item");l.attr("data-"+e.attr("name"),e.val()),l.data(e.attr("name"),e.val()),l.find('> .dd3-content .text[data-update="'+e.attr("name")+'"]').text(e.val()),""==e.val().trim()&&l.find('> .dd3-content .text[data-update="'+e.attr("name")+'"]').text(e.attr("data-old")),t($("#nestable > ol.dd-list li.dd-item"))}),$body.on("click",".box-links-for-menu .btn-add-to-menu",function(a){a.preventDefault();var e=$(this),l=e.parents(".the-box"),d="",n='<label class="pad-bot-5 dis-inline-block"><span class="text pad-top-5" data-update="iconfont">Icon - font</span><input type="text" name="iconfont" value="" data-old=""></label>';if("external_link"==l.attr("id")){var i="custom-link",s=0,c=$("#node-title").val(),o=$("#node-url").val(),r=$("#node-css").val(),p='<label class="pad-bot-5"><span class="text pad-top-5 dis-inline-block" data-update="customurl">Url</span><input type="text" data-old="'+o+'" value="'+o+'" name="customurl"></label>';d+='<li data-type="'+i+'" data-relatedid="'+s+'" data-title="'+c+'" data-class="'+r+'" data-id="0" data-customurl="'+o+'" data-iconfont="" class="dd-item dd3-item">',d+='<div class="dd-handle dd3-handle"></div>',d+='<div class="dd3-content">',d+='<span class="text pull-left" data-update="title">'+c+"</span>",d+='<span class="text pull-right">'+i+"</span>",d+='<a href="#" title="" class="show-item-details"><i class="fa fa-angle-down"></i></a>',d+='<div class="clearfix"></div>',d+="</div>",d+='<div class="item-details">',d+='<label class="pad-bot-5">',d+='<span class="text pad-top-5 dis-inline-block" data-update="title">Title</span>',d+='<input type="text" data-old="'+c+'" value="'+c+'" name="title">',d+="</label>",d+=p+n,d+='<label class="pad-bot-10">',d+='<span class="text pad-top-5 dis-inline-block" data-update="class">CSS class</span>',d+='<input type="text" data-old="'+r+'" value="'+r+'" name="class">',d+="</label>",d+='<div class="text-right">',d+='<a class="btn red btn-remove" title="" href="#">Remove</a>',d+='<a class="btn blue btn-cancel" title="" href="#">Cancel</a>',d+="</div>",d+="</div>",d+='<div class="clearfix"></div>',d+="</li>",l.find('input[type="text"]').val("")}else l.find(".list-item > li.active").each(function(t,a){var e=$(this).find("> a"),l=e.attr("data-type"),i=e.attr("data-relatedid"),s=e.attr("data-title");d+='<li data-type="'+l+'" data-relatedid="'+i+'" data-title="" data-class="" data-id="0" data-customurl="" data-iconfont="" class="dd-item dd3-item">',d+='<div class="dd-handle dd3-handle"></div>',d+='<div class="dd3-content">',d+='<span class="text pull-left" data-update="title">'+s+"</span>",d+='<span class="text pull-right">'+l+"</span>",d+='<a href="#" title="" class="show-item-details"><i class="fa fa-angle-down"></i></a>',d+='<div class="clearfix"></div>',d+="</div>",d+='<div class="item-details">',d+='<label class="pad-bot-5">',d+='<span class="text pad-top-5 dis-inline-block" data-update="title">Title</span>',d+='<input type="text" data-old="'+s+'" value="" name="title">',d+="</label>"+n,d+='<label class="pad-bot-10">',d+='<span class="text pad-top-5 dis-inline-block" data-update="class">CSS class</span>',d+='<input type="text" data-old="" value="" name="class">',d+="</label>",d+='<div class="text-right">',d+='<a class="btn red btn-remove" title="" href="#">Remove</a>',d+='<a class="btn blue btn-cancel" title="" href="#">Cancel</a>',d+="</div>",d+="</div>",d+='<div class="clearfix"></div>',d+="</li>"});$(".nestable-menu > ol.dd-list").append(d),t($("#nestable > ol.dd-list li.dd-item")),l.find(".list-item > li.active").removeClass("active")}),$('.form-save-menu input[name="deleted_nodes"]').val(""),$body.on("click",".nestable-menu .item-details .btn-remove",function(t){t.preventDefault();var a=$(this),e=a.parents(".item-details").parent();$elm=$('.form-save-menu input[name="deleted_nodes"]'),$elm.val($elm.val()+" "+e.attr("data-id"));var l=e.find("> .dd-list").html();""!=l&&null!=l&&e.before(l),e.remove()}),$body.on("click",".nestable-menu .item-details .btn-cancel",function(t){t.preventDefault();var a=$(this),e=a.parents(".item-details").parent();e.find('input[type="text"]').each(function(t,a){var e=$(this);e.val(e.attr("data-old"))}),e.find('input[type="text"]').trigger("change"),e.removeClass("active")}),$body.on("click",".box-links-for-menu .list-item > li > a",function(t){t.preventDefault();var a=$(this).parent();a.toggleClass("active")}),$body.on("submit",".form-save-menu",function(t){var l=$("#nestable");if(l.length<1)$("#nestable-output").val("[]");else{var d=a(l),n=e(d);$("#nestable-output").val(JSON.stringify(n))}})}}}();